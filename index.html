<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inspector Sigma Core 1.0</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Pretendard:wght@400;600;700&display=swap');
        
        [v-cloak] { display: none; }

        :root {
            color-scheme: dark;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #000000;
            color: #ffffff;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨ ÎÖ∏Ïù¥Ï¶à Ìö®Í≥º */
        .cyber-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.02;
            background: url('https://www.transparenttextures.com/patterns/stardust.png');
            animation: noise-flicker 0.2s infinite;
        }

        @keyframes noise-flicker {
            0% { transform: translate(0,0); }
            10% { transform: translate(-0.5%,-0.5%); }
            20% { transform: translate(0.5%,0.5%); }
            30% { transform: translate(-1%,0.5%); }
            40% { transform: translate(1%,-0.5%); }
            50% { transform: translate(-0.5%,1%); }
            60% { transform: translate(0.5%,-1%); }
            70% { transform: translate(1%,1%); }
            80% { transform: translate(-1%,-1%); }
            90% { transform: translate(0.5%,0.5%); }
            100% { transform: translate(0,0); }
        }

        /* Í∞ÄÎÅî Î∞úÏÉùÌïòÎäî Í∏ÄÎ¶¨Ïπò Ìö®Í≥º */
        .glitch-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(59, 130, 246, 0.02);
            pointer-events: none;
            z-index: 9998;
            animation: periodic-glitch 10s infinite;
            opacity: 0;
        }

        @keyframes periodic-glitch {
            0%, 95%, 100% { opacity: 0; transform: scaleY(1); }
            96% { opacity: 1; transform: scaleY(1.01) skewX(1deg); }
            97% { opacity: 0; }
            98% { opacity: 0.5; transform: scaleY(0.99) skewX(-1deg); }
            99% { opacity: 0; }
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        .glass-panel {
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cyber-card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            position: relative;
            overflow: hidden;
        }

        .cyber-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: #3b82f6;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .cyber-card:hover::before {
            opacity: 1;
        }

        .status-box {
            background: rgba(20, 20, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .scanline {
            width: 100%;
            height: 2px;
            background: rgba(59, 130, 246, 0.1);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
            pointer-events: none;
            animation: scanline 6s linear infinite;
        }

        @keyframes scanline {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .tab-active {
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
        }

        /* ÌåùÏóÖ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .modal-enter-active, .modal-leave-active { transition: all 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; transform: scale(0.95); }

        /* Ìè∞Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†àÏö© */
        .text-base-custom { font-size: var(--base-font-size, 14px); }
        .text-title-custom { font-size: var(--title-font-size, 18px); }
    </style>
</head>
<body class="selection:bg-blue-500/30">
    <div class="cyber-noise"></div>
    <div class="glitch-overlay"></div>
    <div id="app" v-cloak class="max-w-4xl mx-auto min-h-screen flex flex-col pb-20" :style="{'--base-font-size': fontSize + 'px', '--title-font-size': (parseInt(fontSize) + 4) + 'px', '--selected-font': currentFont}">
        <div class="scanline"></div>

        <!-- ÏÉÅÎã® Ìó§Îçî ÏÑπÏÖò -->
        <header class="p-6 md:p-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
            <div>
                <h1 class="text-4xl md:text-5xl font-orbitron font-bold tracking-tighter flex items-center gap-3">
                    <span class="text-4xl md:text-5xl">üëÆ</span>
                    <span class="text-white">INSPECTOR</span>
                    <span class="text-blue-500">SIGMA</span>
                    <span class="text-white">1.0</span>
                </h1>
                <p class="text-xs md:text-sm font-orbitron text-gray-500 mt-2 tracking-widest uppercase">
                    Though the world be false, I will remain true to myself
                </p>
            </div>

            <div class="flex gap-4 w-full md:w-auto">
                <div class="status-box flex-1 md:w-32 p-3 text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-orbitron mb-1">INDEXED NODES</p>
                    <p class="text-2xl font-bold text-blue-500">{{ displayCount }}</p>
                </div>
                <!-- Mission Countdown Ï∂îÍ∞Ä -->
                <div class="status-box flex-1 md:w-32 p-3 text-center border-blue-500/20">
                    <p class="text-[10px] text-gray-500 uppercase font-orbitron mb-1">MISSION D-DAY</p>
                    <p :class="['text-2xl font-bold', dDay <= 7 ? 'text-red-500 animate-pulse' : 'text-blue-400']">
                        {{ dDay >= 0 ? 'D-' + dDay : 'D+' + Math.abs(dDay) }}
                    </p>
                </div>
                <!-- Ï†êÏàò Í∏∞Î°ù (Training Rating) Ï∂îÍ∞Ä -->
                <div class="status-box flex-1 md:w-32 p-3 text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-orbitron mb-1">AVG RATING</p>
                    <p class="text-2xl font-bold text-green-500">{{ avgScore }}%</p>
                </div>
            </div>
        </header>

        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="px-6 md:px-10 border-b border-white/5 flex gap-6 mb-8 overflow-x-auto hide-scrollbar scroll-smooth">
            <button v-for="tab in tabs" :key="tab.id"
                @click="currentTab = tab.id"
                :class="['pb-4 text-[11px] font-orbitron uppercase tracking-widest transition-colors relative whitespace-nowrap', 
                         currentTab === tab.id ? 'text-blue-500' : 'text-gray-500 hover:text-gray-300']">
                {{ tab.name }}
                <div v-if="currentTab === tab.id" class="absolute bottom-0 left-0 w-full h-[2px] bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.6)]"></div>
            </button>
        </nav>

        <!-- Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ ÏÑπÏÖò -->
        <div v-if="isDataTab && !loading" class="px-6 md:px-10 mb-8">
            <div class="status-box p-4 md:p-6 flex flex-col lg:flex-row gap-4 items-center">
                <!-- Ïª§Ïä§ÌÖÄ Í≤ÄÏÉâÏ∞Ω -->
                <div class="relative flex-1 w-full">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-blue-500 font-orbitron">>_</span>
                    <input type="text" v-model="searchQuery" 
                        placeholder="ÏãúÏä§ÌÖú ÏøºÎ¶¨ ÏûÖÎ†• (Ïù∏Î¨º, ÏßÄÎ™Ö, Ï°∞ÏïΩ, ÏÇ¨Í±¥...)" 
                        class="w-full bg-black/40 border border-white/10 rounded-xl py-3 pl-12 pr-4 text-sm focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 transition-all">
                </div>
                
                <!-- ÌïÑÌÑ∞ ÏÖÄÎ†âÌä∏ -->
                <div class="flex gap-3 w-full lg:w-auto">
                    <!-- ÌïúÍµ≠ÏÇ¨ÏóêÏÑúÎßå ÌëúÏãúÎêòÎäî ÏãúÎåÄ ÌïÑÌÑ∞ -->
                    <div v-if="currentTab === 'korean_history'" class="relative flex-1 lg:w-40">
                        <select v-model="selectedEra" class="w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-xs appearance-none focus:outline-none focus:border-blue-500/50">
                            <option value="Ï†ÑÏ≤¥">Ï†Ñ ÏãúÎåÄ (All Eras)</option>
                            <option v-for="era in uniqueEras" :key="era" :value="era">{{ era }}</option>
                        </select>
                    </div>
                    <!-- Í≥µÌÜµ Î∂ÑÎ•ò ÌïÑÌÑ∞ -->
                    <div class="relative flex-1 lg:w-40">
                        <select v-model="selectedCategory" class="w-full bg-black/40 border border-white/10 rounded-xl py-3 px-4 text-xs appearance-none focus:outline-none focus:border-blue-500/50">
                            <option value="Ï†ÑÏ≤¥">Ï†Ñ Î∂ÑÎ•ò (Categories)</option>
                            <option v-for="cat in uniqueCategories" :key="cat" :value="cat">{{ cat }}</option>
                        </select>
                    </div>
                    <!-- Ï†êÏàò ÏûÖÎ†• Î≤ÑÌäº -->
                    <button @click="showScoreInput = !showScoreInput" 
                        class="px-4 py-3 bg-blue-500/10 border border-blue-500/30 rounded-xl text-[10px] font-orbitron text-blue-500 hover:bg-blue-500/20 transition-all whitespace-nowrap">
                        SCORE LOG
                    </button>
                </div>
            </div>

            <!-- Ï†êÏàò ÏûÖÎ†• Ìå®ÎÑê (ÌïÑÌÑ∞ ÏïÑÎûò) -->
            <transition name="fade">
                <div v-if="showScoreInput" class="status-box p-4 mt-4 border-blue-500/20 bg-blue-500/5">
                    <div class="flex items-center justify-between gap-4">
                        <div class="flex-1">
                            <p class="text-[10px] text-blue-400 font-orbitron mb-2 uppercase tracking-widest">Training Performance Input</p>
                            <div class="flex gap-2">
                                <input type="number" v-model="newScore" placeholder="SCORE" 
                                    class="w-full bg-black/60 border border-blue-500/30 rounded-lg py-2 px-3 text-sm focus:outline-none focus:border-blue-500"
                                    @keyup.enter="saveScore">
                                <button @click="saveScore" class="px-6 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold font-orbitron">SAVE</button>
                            </div>
                        </div>
                        <div class="w-[1px] h-12 bg-white/10"></div>
                        <div class="text-right">
                            <p class="text-[9px] text-gray-500 font-orbitron uppercase">Recent Records</p>
                            <div class="flex gap-1 mt-1 justify-end overflow-x-auto max-w-[150px]">
                                <span v-for="(s, idx) in scoreHistory.slice(0, 5)" :key="idx" 
                                    class="text-[10px] bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded border border-blue-500/10">
                                    {{ s }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
        </div>

        <!-- ÏΩòÌÖêÏ∏† Î°úÎî© ÏÉÅÌÉú -->
        <main v-if="loading" class="px-6 md:px-10 py-20 text-center">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-gray-500 font-orbitron text-xs tracking-widest uppercase">Synchronizing Nodes...</p>
        </main>

        <!-- ÌïúÍµ≠ÏÇ¨/Î≤ïÌïô ÌÉ≠ ÏΩòÌÖêÏ∏† -->
        <main v-else-if="isDataTab" class="px-6 md:px-10 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div v-for="(item, idx) in sortedFilteredList" :key="item.id" 
                @click="openPopup(item)"
                :class="['cyber-card group p-6 rounded-2xl flex flex-col justify-between min-h-[180px] cursor-pointer transition-all duration-300', 
                         pinnedNodes.includes(item.id) ? 'border-blue-500/50 shadow-[0_0_15px_rgba(59,130,246,0.2)]' : '']">
                
                <div>
                    <!-- Ïπ¥Îìú Ìó§Îçî -->
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex flex-col gap-1">
                            <span class="text-[10px] uppercase tracking-tighter text-gray-500 font-medium">
                                <template v-if="currentTab === 'korean_history'">
                                    {{ item['ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò'] }} | {{ item['ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò'] }}
                                </template>
                                <template v-else>
                                    {{ item.Í≥ºÎ™©Î∂ÑÎ•ò }}
                                </template>
                            </span>
                            <h2 class="font-bold group-hover:text-blue-400 transition-colors text-title-custom flex items-center gap-2">
                                {{ item.Ï†úÎ™© || item.ÎåÄÏ£ºÏ†ú }}
                                <svg v-if="nodeMemos[item.id]" class="w-3 h-3 text-blue-500/50" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                                    <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                                </svg>
                            </h2>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            <button @click="togglePin(item.id, $event)" 
                                :class="['p-1.5 rounded-lg transition-all', pinnedNodes.includes(item.id) ? 'text-blue-500 bg-blue-500/10' : 'text-gray-600 hover:text-gray-400 hover:bg-white/5']">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z" />
                                </svg>
                            </button>
                            <span v-if="getViewCount(item.id) > 0" class="text-[9px] font-orbitron text-green-500/60">ACCESS: {{ getViewCount(item.id) }}</span>
                        </div>
                    </div>

                    <!-- ÌïúÍµ≠ÏÇ¨ ÎÇ¥Ïö© Î†åÎçîÎßÅ -->
                    <div v-if="currentTab === 'korean_history'" class="space-y-3 mt-4 mb-2">
                        <div v-for="(line, lIdx) in splitContent(item.ÎÇ¥Ïö©)" :key="lIdx" 
                            class="flex items-start gap-2 leading-relaxed">
                            <!-- Î≤àÌò∏ Îß§Í∏∞Í∏∞(1.)Í∞Ä ÏïÑÎãàÎ©¥ Î∂àÎ†õ Ìè¨Ïù∏Ìä∏ ÌëúÏãú -->
                            <span v-if="!isNumberedLine(line)" class="text-blue-500 shrink-0 text-lg leading-[1.2]">‚Ä¢</span>
                            <span :class="[
                                'text-base-custom break-keep flex-1 transition-all',
                                (lIdx === 0 || isNumberedLine(line)) ? 'text-gray-100 font-bold' : 'text-gray-500 text-[0.95em]',
                                isNumberedLine(line) ? 'ml-1' : '',
                                isImportantLine(line) ? 'text-blue-400 drop-shadow-[0_0_8px_rgba(96,165,250,0.6)] font-bold' : ''
                            ]">
                                {{ cleanText(line) }}
                            </span>
                        </div>
                    </div>
                    <!-- Î≤ïÌïô ÎÇ¥Ïö© Î†åÎçîÎßÅ -->
                    <div v-else class="space-y-2 mt-4 mb-2 text-base-custom text-gray-300 leading-relaxed">
                        <div v-for="(line, lIdx) in renderLawContent(item.ÎÇ¥Ïö©)" :key="lIdx" 
                            :class="['flex gap-2 transition-all duration-300', line.level > 0 ? 'border-l border-white/5' : '']"
                            :style="{ paddingLeft: (line.level * 1.5) + 'rem' }">
                            <span v-if="line.level === 0" class="text-blue-500 mt-1 shrink-0">‚ñ∂</span>
                            <span v-else class="text-gray-600 mt-1 shrink-0">‚Ä¢</span>
                            <span :class="['break-keep', line.important ? 'text-blue-400 drop-shadow-[0_0_8px_rgba(96,165,250,0.6)] font-bold' : '']" 
                                  v-html="highlightText(line.text)"></span>
                        </div>
                    </div>
                </div>

                <!-- Ïπ¥Îìú Ìë∏ÌÑ∞ -->
                <div class="mt-8 pt-4 border-t border-white/5 flex justify-between items-center opacity-40 group-hover:opacity-100 transition-opacity">
                    <div class="flex items-center gap-2">
                        <svg class="w-3 h-3 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-[9px] font-orbitron uppercase tracking-widest">ENCRYPTED NODE</span>
                    </div>
                    <span class="text-[9px] font-orbitron uppercase tracking-widest text-gray-500">NODE VERIFIED</span>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÏóÜÏùå -->
            <div v-if="sortedFilteredList && sortedFilteredList.length === 0" class="col-span-full py-20 text-center border border-dashed border-white/10 rounded-2xl">
                <p class="text-gray-500 font-orbitron uppercase tracking-widest">No matching nodes found in the system.</p>
                <button @click="resetFilters" class="mt-4 text-blue-500 text-xs font-orbitron uppercase tracking-widest border border-blue-500/30 px-4 py-2 rounded-full hover:bg-blue-500/10 transition-colors">
                    Reset Query
                </button>
            </div>
        </main>

        <!-- ÏÑ§Ï†ï ÌÉ≠ -->
        <main v-else-if="currentTab === 'settings'" class="px-6 md:px-10">
            <div class="cyber-card p-8 rounded-2xl">
                <h3 class="text-xl font-orbitron text-blue-500 mb-6 uppercase tracking-widest">System Configuration</h3>
                
                <div class="space-y-8">
                    <!-- Ìè∞Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†à -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-orbitron text-gray-400 uppercase tracking-wider">Font Scaling</label>
                            <span class="text-blue-500 font-orbitron">{{ fontSize }}px</span>
                        </div>
                        <input type="range" v-model="fontSize" min="12" max="24" step="1"
                            class="w-full h-1 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500">
                        <div class="flex justify-between text-[10px] text-gray-600 font-orbitron">
                            <span>MIN (12PX)</span>
                            <span>MAX (24PX)</span>
                        </div>
                    </div>

                    <!-- ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî -->
                    <div class="pt-6 border-t border-white/5">
                        <label class="text-sm font-orbitron text-gray-400 uppercase tracking-wider mb-4 block">Data Management</label>
                        <button @click="clearStats" class="px-4 py-2 border border-red-500/30 text-red-500 text-xs font-orbitron uppercase tracking-widest rounded hover:bg-red-500/10 transition-all">
                            Clear Access Logs
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Îã§Î•∏ ÌÉ≠ placeholder -->
        <main v-else class="px-6 md:px-10 py-20 text-center">
            <div class="status-box p-10 border-dashed border-white/10">
                <h3 class="text-xl font-orbitron text-gray-600 mb-2">ACCESS RESTRICTED</h3>
                <p class="text-xs text-gray-700 font-orbitron tracking-widest uppercase">This sector is currently under construction or encrypted.</p>
                <div class="mt-8 flex justify-center gap-2">
                    <div class="w-1 h-1 bg-blue-500 animate-pulse"></div>
                    <div class="w-1 h-1 bg-blue-500 animate-pulse delay-75"></div>
                    <div class="w-1 h-1 bg-blue-500 animate-pulse delay-150"></div>
                </div>
            </div>
        </main>

        <!-- ÏÉÅÎã® ÌîåÎ°úÌåÖ Î≤ÑÌäº -->
        <button @click="scrollToTop" 
            class="fixed bottom-8 right-8 w-14 h-14 glass-panel text-blue-500 rounded-xl flex items-center justify-center hover:bg-blue-500 hover:text-white transition-all active:scale-90 z-50 shadow-[0_0_20px_rgba(59,130,246,0.2)]"
            v-show="showScrollTop">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11l7-7m0 0l7 7m-7-7v18" />
            </svg>
        </button>

        <!-- Îç∞Ïù¥ÌÑ∞ ÏÉÅÏÑ∏ Î∂ÑÏÑù ÌåùÏóÖ (Î™®Îã¨) -->
        <transition name="modal">
            <div v-if="selectedItem" class="fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6">
                <div class="absolute inset-0 bg-black/90 backdrop-blur-md" @click="closePopup"></div>
                
                <div class="cyber-card w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 md:p-10 rounded-3xl border-blue-500/30 shadow-[0_0_50px_rgba(59,130,246,0.2)] relative z-10">
                    <!-- ÌåùÏóÖ Ìó§Îçî -->
                    <div class="flex justify-between items-start mb-8 border-b border-white/5 pb-6">
                        <div>
                            <span class="text-[10px] font-orbitron text-blue-500 uppercase tracking-[0.2em] block mb-2">Node Detailed Analysis</span>
                            <h2 class="text-2xl md:text-3xl font-bold text-white tracking-tight">{{ selectedItem.Ï†úÎ™© || selectedItem.ÎåÄÏ£ºÏ†ú }}</h2>
                            <p class="text-xs text-gray-500 mt-2 font-orbitron uppercase">{{ selectedItem['ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò'] }} | {{ selectedItem['ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò'] }}</p>
                        </div>
                        <button @click="closePopup" class="p-2 text-gray-500 hover:text-white transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- ÎÇ¥Ïö© ÏÑπÏÖò -->
                    <div class="space-y-6">
                        <!-- ÏõêÎ¨∏ Îç∞Ïù¥ÌÑ∞ -->
                        <div>
                            <label class="text-[10px] font-orbitron text-gray-500 uppercase tracking-widest block mb-4">Central Intelligence Data</label>
                            <div v-if="currentTab === 'korean_history'" class="space-y-4 bg-white/5 p-6 rounded-2xl border border-white/5">
                                <div v-for="(line, lIdx) in splitContent(selectedItem.ÎÇ¥Ïö©)" :key="lIdx" class="flex gap-3">
                                    <span v-if="!isNumberedLine(line)" class="text-blue-500 mt-1.5 text-lg">‚Ä¢</span>
                                    <p :class="['text-base md:text-lg leading-relaxed break-keep flex-1 transition-all', 
                                               (lIdx === 0 || isNumberedLine(line)) ? 'text-gray-100 font-bold' : 'text-gray-400',
                                               isNumberedLine(line) ? 'ml-1' : '',
                                               isImportantLine(line) ? 'text-blue-400 drop-shadow-[0_0_8px_rgba(96,165,250,0.6)] font-bold' : '']">{{ cleanText(line) }}</p>
                                </div>
                                <!-- ÌåùÏóÖ ÎÇ¥ ÏÑúÎ∏åÌÇ§ÏõåÎìú ÌëúÏãú Ï∂îÍ∞Ä -->
                                <div class="flex flex-wrap gap-2 mt-6 pt-4 border-t border-white/5">
                                    <span v-for="(tag, tIdx) in splitContent(selectedItem.ÏÑúÎ∏åÌÇ§ÏõåÎìú)" :key="tIdx"
                                        class="px-2 py-0.5 bg-blue-500/10 border border-blue-500/20 rounded text-xs text-blue-400 font-medium">
                                        #{{ tag.trim() }}
                                    </span>
                                </div>
                            </div>
                            <div v-else class="space-y-3 bg-white/5 p-6 rounded-2xl border border-white/5">
                                <div v-for="(line, lIdx) in renderLawContent(selectedItem.ÎÇ¥Ïö©)" :key="lIdx" 
                                    :class="['flex gap-3 transition-all', line.level > 0 ? 'border-l border-white/10 ml-4 pl-4' : '']">
                                    <span v-if="line.level === 0" class="text-blue-500 mt-1">‚ñ∂</span>
                                    <p :class="['text-base md:text-lg leading-relaxed break-keep flex-1', 
                                               line.important ? 'text-blue-400 drop-shadow-[0_0_8px_rgba(96,165,250,0.6)] font-bold' : 'text-gray-200']" 
                                       v-html="highlightText(line.text)"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Í∞úÏù∏ Î©îÎ™®Ïû• (Field Notes) -->
                        <div class="pt-6 border-t border-white/5">
                            <div class="flex justify-between items-center mb-4">
                                <label class="text-[10px] font-orbitron text-blue-500 uppercase tracking-widest">Field Investigator Notes</label>
                                <span class="text-[9px] text-gray-600 font-orbitron uppercase">Auto-saving to Local Grid</span>
                            </div>
                            <textarea 
                                :value="nodeMemos[selectedItem.id]"
                                @input="updateMemo(selectedItem.id, $event)"
                                class="w-full bg-black/60 border border-white/10 rounded-2xl p-5 text-sm md:text-base text-blue-100 h-40 focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 transition-all placeholder:text-gray-700" 
                                placeholder="Ïù¥ ÎÖ∏ÎìúÏóê ÎåÄÌïú Î∂ÑÏÑù Í≤∞Í≥ºÎÇò ÏïîÍ∏∞ ÎπÑÎ≤ïÏùÑ Í∏∞Î°ùÌïòÏÑ∏Ïöî..."></textarea>
                        </div>
                    </div>

                    <!-- ÌåùÏóÖ Ìë∏ÌÑ∞ -->
                    <div class="mt-10 flex justify-between items-center pt-6 border-t border-white/5 opacity-40 text-[9px] font-orbitron tracking-widest uppercase">
                        <span>Status: Verified</span>
                        <span>Node ID: {{ selectedItem.id }}</span>
                    </div>
                </div>
            </div>
        </transition>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch } = Vue;

        createApp({
            setup() {
                const items = ref([]);
                const loading = ref(true);
                const searchQuery = ref('');
                const selectedEra = ref('Ï†ÑÏ≤¥');
                const selectedCategory = ref('Ï†ÑÏ≤¥');
                const showScrollTop = ref(false);
                const currentTab = ref('korean_history');
                
                // ÏÉàÎ°úÏö¥ ÏÉÅÌÉúÎì§
                const showScoreInput = ref(false);
                const newScore = ref(null);
                const scoreHistory = ref(JSON.parse(localStorage.getItem('sigma-scores') || '[]'));
                const examDates = ref({}); // Í≥ºÎ™©Î≥Ñ ÏãúÌóò ÎÇ†Ïßú Ï†ÄÏû•Ïö© Í∞ùÏ≤¥

                const syncApiUrl = 'https://script.google.com/macros/s/AKfycbzaaGoc81uxapvqSMcHuHVcNtw4JPqc9YZ7y3uyFBETjjPNEuH7R8HPGAp_QrSP5uVTzw/exec';
                const isSyncing = ref(false);

                // ÌÅ¥ÎùºÏö∞Îìú Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî Ìï®Ïàò
                const syncWithCloud = async () => {
                    isSyncing.value = true;
                    try {
                        // 1. ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ (GET)
                        const response = await fetch(syncApiUrl);
                        const cloudData = await response.json();
                        
                        // 2. Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ÏôÄ Î≥ëÌï©
                        cloudData.forEach(row => {
                            if (row.id) {
                                // Ï°∞ÌöåÏàò Î≥ëÌï© (Îçî ÌÅ∞ Í∞í Ïö∞ÏÑ†)
                                if (row.viewCount) {
                                    viewCounts.value[row.id] = Math.max(viewCounts.value[row.id] || 0, parseInt(row.viewCount));
                                }
                                // Î©îÎ™® Î≥ëÌï© (ÌÅ¥ÎùºÏö∞Îìú Ïö∞ÏÑ†)
                                if (row.memo) {
                                    nodeMemos.value[row.id] = row.memo;
                                }
                            }
                        });
                        
                        // Î°úÏª¨ Ï†ÄÏû•ÏÜå ÏóÖÎç∞Ïù¥Ìä∏
                        localStorage.setItem('sigma-view-counts', JSON.stringify(viewCounts.value));
                        localStorage.setItem('sigma-node-memos', JSON.stringify(nodeMemos.value));
                        
                        console.log('Cloud Sync Complete');
                    } catch (err) {
                        console.error('Cloud Sync Failed:', err);
                    } finally {
                        isSyncing.value = false;
                    }
                };

                // ÌÅ¥ÎùºÏö∞ÎìúÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ìï®Ïàò (POST)
                const saveToCloud = async (id, data) => {
                    try {
                        await fetch(syncApiUrl, {
                            method: 'POST',
                            mode: 'no-cors', // Apps Script CORS ÎåÄÏùë
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ id, ...data })
                        });
                    } catch (err) {
                        console.error('Save to Cloud Failed:', err);
                    }
                };
                const savedFontSize = localStorage.getItem('sigma-font-size');
                const fontSize = ref(savedFontSize ? parseInt(savedFontSize) : 14);
                
                const currentFont = ref(localStorage.getItem('sigma-font-family') || 'Pretendard');
                
                const pinnedNodes = ref(JSON.parse(localStorage.getItem('sigma-pinned-nodes') || '[]'));
                const nodeMemos = ref(JSON.parse(localStorage.getItem('sigma-node-memos') || '{}'));
                const selectedItem = ref(null);

                const fontOptions = [
                    { name: 'ÌîÑÎ¶¨ÌÖêÎã§Îìú', value: 'Pretendard' },
                    { name: 'ÎÖ∏ÌÜ†ÏÇ∞Ïä§', value: 'Noto Sans KR' },
                    { name: 'ÎÇòÎàîÍ≥†Îîï', value: 'Nanum Gothic' },
                    { name: 'ÎÇòÎàîÎ™ÖÏ°∞', value: 'Nanum Myeongjo' },
                    { name: 'Í∞êÏûêÍΩÉ', value: 'Gamja Flower' }
                ];

                let initialCounts = {};
                try {
                    const savedCounts = localStorage.getItem('sigma-view-counts');
                    if (savedCounts) initialCounts = JSON.parse(savedCounts);
                } catch (e) {
                    console.error('Error loading view counts:', e);
                }
                const viewCounts = ref(initialCounts);

                const tabs = ref([
                    { id: 'korean_history', name: 'ÌïúÍµ≠ÏÇ¨', category: 'ÌïúÍµ≠ÏÇ¨' },
                    { id: 'criminal_law_general', name: 'ÌòïÎ≤ï Ï¥ùÎ°†', category: 'ÌòïÎ≤ï Ï¥ùÎ°†' },
                    { id: 'criminal_law_special', name: 'ÌòïÎ≤ï Í∞ÅÎ°†', category: 'ÌòïÎ≤ï Í∞ÅÎ°†' },
                    { id: 'criminal_procedure', name: 'ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï', category: 'ÌòïÏÇ¨ÏÜåÏÜ°Î≤ï' },
                    { id: 'constitutional_law', name: 'ÌóåÎ≤ï', category: 'ÌóåÎ≤ï' },
                    { id: 'info_security', name: 'Ï†ïÎ≥¥Î≥¥Ìò∏Î°†', category: 'Ï†ïÎ≥¥Î≥¥Ìò∏Î°†' },
                    { id: 'network_security', name: 'ÎÑ§Ìä∏ÏõåÌÅ¨Î≥¥Ïïà', category: 'ÎÑ§Ìä∏ÏõåÌÅ¨Î≥¥Ïïà' },
                    { id: 'software_engineering', name: 'ÏÜåÌîÑÌä∏Ïõ®Ïñ¥Í≥µÌïô', category: 'ÏÜåÌîÑÌä∏Ïõ®Ïñ¥Í≥µÌïô' },
                    { id: 'settings', name: 'ÏÑ§Ï†ï' }
                ]);

                const csvUrls = {
                    korean_history: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQE3ia0nwvZ99-e5SF707qTXOq1Vttc8urdPis0KiL7pHfduNdFawGElyYum3wrtl3yzHMdtSw5erix/pub?output=csv',
                    criminal_law_general: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT7EyNB1Shov5WaCaJ2wO6ZnupafraI1jKKG5nsRRPCfaO0r_p_n_uqR0N9c304d6-cS0fKG-iRN6PQ/pub?output=csv'
                };

                const fetchData = async () => {
                    loading.value = true;
                    items.value = []; // Ï¥àÍ∏∞Ìôî
                    
                    try {
                        const fetchPromises = Object.entries(csvUrls).map(async ([tabId, url]) => {
                            const response = await fetch(url + '&t=' + new Date().getTime());
                            const csvText = await response.text();
                            return new Promise((resolve) => {
                                Papa.parse(csvText, {
                                    header: true,
                                    skipEmptyLines: true,
                                    complete: (results) => resolve(results.data)
                                });
                            });
                        });

                        const allData = await Promise.all(fetchPromises);
                        let combinedItems = [];

                        allData.forEach((data) => {
                            // 1. ÏãúÌóò ÎÇ†Ïßú ÏÑ§Ï†ï
                            const configRow = data.find(row => row['Ï†úÎ™©'] === 'EXAM_DATE' || row['ÎåÄÏ£ºÏ†ú'] === 'EXAM_DATE');
                            if (configRow && configRow['ÎÇ¥Ïö©']) {
                                const cat = configRow['Í≥ºÎ™©Î∂ÑÎ•ò'] || 'ÌïúÍµ≠ÏÇ¨';
                                examDates.value[cat.replace(/\s+/g, '')] = new Date(configRow['ÎÇ¥Ïö©']);
                            }

                            // 2. ÏïÑÏù¥ÌÖú Í∞ÄÍ≥µ
                            const filteredData = data.filter(row => 
                                (row['Ï†úÎ™©'] || row['ÎåÄÏ£ºÏ†ú'] || row['ÎÇ¥Ïö©']) && 
                                !(row['Ï†úÎ™©'] === 'EXAM_DATE' || row['ÎåÄÏ£ºÏ†ú'] === 'EXAM_DATE')
                            ).map((row, index) => {
                                const rawCat = row['Í≥ºÎ™©Î∂ÑÎ•ò'] || '';
                                const normalizedCat = rawCat.replace(/\s+/g, '');
                                
                                return {
                                    ...row,
                                    normalizedCategory: normalizedCat,
                                    id: (row['Ï†úÎ™©'] || row['ÎåÄÏ£ºÏ†ú'] || 'no-title') + '_' + normalizedCat + '_' + index
                                };
                            });
                            combinedItems = [...combinedItems, ...filteredData];
                        });

                        items.value = combinedItems;
                        loading.value = false;
                    } catch (err) {
                        console.error('Data sync failed:', err);
                        loading.value = false;
                    }
                };

                const dDay = computed(() => {
                    const currentTabObj = tabs.value.find(t => t.id === currentTab.value);
                    const targetCat = currentTabObj?.category?.replace(/\s+/g, ''); // ÌÉ≠ Ïù¥Î¶Ñ Í≥µÎ∞± Ï†úÍ±∞
                    const targetDate = examDates.value[targetCat] || new Date('2026-02-07');
                    
                    if (isNaN(targetDate.getTime())) return 0;
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const diff = targetDate - today;
                    return Math.ceil(diff / (1000 * 60 * 60 * 24));
                });

                const avgScore = computed(() => {
                    if (scoreHistory.value.length === 0) return 0;
                    const sum = scoreHistory.value.reduce((a, b) => a + b, 0);
                    return Math.round(sum / scoreHistory.value.length);
                });

                const saveScore = () => {
                    if (newScore.value === null || newScore.value === '') return;
                    const score = parseInt(newScore.value);
                    if (isNaN(score)) return;
                    
                    scoreHistory.value.unshift(score);
                    localStorage.setItem('sigma-scores', JSON.stringify(scoreHistory.value));
                    newScore.value = null;
                    showScoreInput.value = false;
                };

                const uniqueEras = computed(() => {
                    if (currentTab.value !== 'korean_history') return [];
                    const filteredItems = items.value.filter(item => item['Í≥ºÎ™©Î∂ÑÎ•ò'] === 'ÌïúÍµ≠ÏÇ¨');
                    return [...new Set(filteredItems.map(i => i['ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò']))].filter(Boolean);
                });

                const uniqueCategories = computed(() => {
                    const currentTabObj = tabs.value.find(t => t.id === currentTab.value);
                    if (!currentTabObj?.category) return [];
                    
                    const filteredItems = items.value.filter(item => item['Í≥ºÎ™©Î∂ÑÎ•ò'] === currentTabObj.category);
                    if (currentTab.value === 'korean_history') {
                        return [...new Set(filteredItems.map(i => i['ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò']))].filter(Boolean);
                    }
                    return [...new Set(filteredItems.map(i => i['Î∂ÑÎ•ò'] || i['ÎåÄÏ£ºÏ†ú']))].filter(Boolean);
                });

                const isDataTab = computed(() => {
                    const allowedTabs = ['korean_history', 'criminal_law_general'];
                    return allowedTabs.includes(currentTab.value);
                });

                const displayCount = computed(() => {
                    if (loading.value) return 0;
                    if (!isDataTab.value) return 0;
                    const list = sortedFilteredList.value;
                    return list ? list.length : 0;
                });

                const sortedFilteredList = computed(() => {
                    if (!items.value || items.value.length === 0) return [];
                    
                    const currentTabObj = tabs.value.find(t => t.id === currentTab.value);
                    if (!currentTabObj || !currentTabObj.category) return [];
                    const targetNormalized = currentTabObj.category.replace(/\s+/g, '');

                    const filtered = items.value.filter(item => {
                        if (!item) return false;
                        
                        // 1. Í≥ºÎ™© Îß§Ïπ≠ (Ï†ïÍ∑úÌôîÎêú Ïù¥Î¶ÑÏúºÎ°ú Îß§Ïπ≠)
                        if (item.normalizedCategory !== targetNormalized) return false;

                        // 2. Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
                        const s = searchQuery.value.toLowerCase();
                        const era = String(item['ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò'] || '');
                        const subEra = String(item['ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò'] || '');
                        const title = String(item['Ï†úÎ™©'] || item['ÎåÄÏ£ºÏ†ú'] || '');
                        const subKey = String(item['ÏÑúÎ∏åÌÇ§ÏõåÎìú'] || '');
                        const content = String(item['ÎÇ¥Ïö©'] || '');
                        
                        const searchableText = `${era} ${subEra} ${title} ${subKey} ${content}`.toLowerCase();
                        const matchSearch = searchableText.includes(s);
                        
                        // 3. ÌïÑÌÑ∞ÎßÅ (ÌïúÍµ≠ÏÇ¨: ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò & ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò / Î≤ïÌïô: Î∂ÑÎ•ò)
                        let matchFilter = true;
                        if (currentTab.value === 'korean_history') {
                            const matchEra = selectedEra.value === 'Ï†ÑÏ≤¥' || item['ÏãúÎåÄ ÎåÄÎ∂ÑÎ•ò'] === selectedEra.value;
                            const matchCat = selectedCategory.value === 'Ï†ÑÏ≤¥' || item['ÏãúÎåÄ ÏÜåÎ∂ÑÎ•ò'] === selectedCategory.value;
                            matchFilter = matchEra && matchCat;
                        } else {
                            // ÎÇòÎ®∏ÏßÄÎäî Î∂ÑÎ•ò(ÎòêÎäî ÎåÄÏ£ºÏ†ú) ÌïÑÌÑ∞Îßå ÏÇ¨Ïö©
                            matchFilter = selectedCategory.value === 'Ï†ÑÏ≤¥' || 
                                         (item['Î∂ÑÎ•ò'] || item['ÎåÄÏ£ºÏ†ú']) === selectedCategory.value;
                        }
                        
                        return matchSearch && matchFilter;
                    });

                    // Ï†ïÎ†¨: 1ÏàúÏúÑ Í≥†Ï†ï Ïó¨Î∂Ä, 2ÏàúÏúÑ Ï°∞ÌöåÏàò
                    return filtered.sort((a, b) => {
                        const isPinnedA = pinnedNodes.value.includes(a.id) ? 1 : 0;
                        const isPinnedB = pinnedNodes.value.includes(b.id) ? 1 : 0;
                        
                        if (isPinnedA !== isPinnedB) return isPinnedB - isPinnedA;
                        
                        const countA = viewCounts.value[a.id] || 0;
                        const countB = viewCounts.value[b.id] || 0;
                        return countB - countA;
                    });
                });

                const togglePin = (id, event) => {
                    event.stopPropagation();
                    const index = pinnedNodes.value.indexOf(id);
                    if (index > -1) {
                        pinnedNodes.value.splice(index, 1);
                    } else {
                        pinnedNodes.value.push(id);
                    }
                    localStorage.setItem('sigma-pinned-nodes', JSON.stringify(pinnedNodes.value));
                };

                const openPopup = (item) => {
                    selectedItem.value = item;
                    incrementViewCount(item);
                };

                const closePopup = () => {
                    selectedItem.value = null;
                };

                let memoTimeout = null;
                const updateMemo = (id, event) => {
                    const newMemo = event.target.value;
                    nodeMemos.value[id] = newMemo;
                    localStorage.setItem('sigma-node-memos', JSON.stringify(nodeMemos.value));
                    
                    // ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî (ÎîîÎ∞îÏö¥Ïã± Ï†ÅÏö©: ÌÉÄÏù¥Ìïë Î©àÏ∂îÍ≥† 0.5Ï¥à Îí§ Ï†ÄÏû•)
                    if (memoTimeout) clearTimeout(memoTimeout);
                    memoTimeout = setTimeout(() => {
                        saveToCloud(id, { memo: newMemo });
                    }, 500);
                };

                const incrementViewCount = (item) => {
                    const currentCount = viewCounts.value[item.id] || 0;
                    viewCounts.value[item.id] = currentCount + 1;
                    localStorage.setItem('sigma-view-counts', JSON.stringify(viewCounts.value));
                    
                    // ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî
                    saveToCloud(item.id, { viewCount: viewCounts.value[item.id] });
                };

                const getViewCount = (id) => viewCounts.value[id] || 0;

                const clearStats = () => {
                    if (confirm('Î™®Îì† Ï†ëÏÜç Î°úÍ∑∏(ÌÑ∞Ïπò ÌöüÏàò)Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        viewCounts.value = {};
                        localStorage.removeItem('sigma-view-counts');
                    }
                };

                const splitContent = (content) => content ? content.split('/') : [];
                
                // Î≤àÌò∏ Îß§Í∏∞Í∏∞(1.) Ïó¨Î∂Ä ÌôïÏù∏ Î°úÏßÅ
                const isNumberedLine = (text) => {
                    if (!text) return false;
                    return /^\d+\./.test(text.trim());
                };

                // Ï§ëÏöî Î¨∏Ïû•(.*) Ïó¨Î∂Ä ÌôïÏù∏ Î∞è ÌÖçÏä§Ìä∏ Ï†ïÏ†ú
                const isImportantLine = (text) => text && text.trim().endsWith('.*');
                const cleanText = (text) => {
                    if (!text) return '';
                    let t = text.trim();
                    return t.endsWith('.*') ? t.slice(0, -1) : t;
                };
                
                // Î≤ïÌïô ÌÉ≠Ïö© ÎÇ¥Ïö© Î†åÎçîÎßÅ (Ï§ÑÎ∞îÍøà Î∞è Î∂àÎ†õ Ìè¨Ïù∏Ìä∏ Ï≤òÎ¶¨)
                const renderLawContent = (content) => {
                    if (!content) return [];
                    return content.split('\n').map(line => {
                        const leadingSpaces = line.match(/^ */)[0].length;
                        const level = Math.floor(leadingSpaces / 4);
                        let text = line.trim().replace(/^- /, '');
                        const important = text.endsWith('.*');
                        if (important) text = text.slice(0, -1);
                        return { text, level, important };
                    });
                };

                const highlightText = (text) => {
                    if (!text) return '';
                    let highlighted = text;
                    
                    // 1. [ÏõêÏπô], [ÏòàÏô∏], [ÌåêÎ°Ä] Í∞ïÏ°∞ (ÌååÎûÄÏÉâ Î∞ïÏä§ ÎäêÎÇå)
                    highlighted = highlighted.replace(/(\[ÏõêÏπô\]|\[ÏòàÏô∏\]|\[ÌåêÎ°Ä\])/g, '<span class="text-blue-400 font-bold">$1</span>');
                    
                    // 2. Ïú†Ï£Ñ, Î¨¥Ï£Ñ, Ìï©Ìóå, ÏúÑÌóå Í∞ïÏ°∞ (ÎÑ§Ïò® Ïª¨Îü¨)
                    highlighted = highlighted.replace(/(Ïú†Ï£Ñ|ÏúÑÌóå|ÏÑ±Î¶Ω)/g, '<span class="text-red-400 font-bold">$1</span>');
                    highlighted = highlighted.replace(/(Î¨¥Ï£Ñ|Ìï©Ìóå|Î©¥Ï£Ñ)/g, '<span class="text-green-400 font-bold">$1</span>');
                    
                    return highlighted;
                };

                const resetFilters = () => { searchQuery.value = ''; selectedEra.value = 'Ï†ÑÏ≤¥'; selectedCategory.value = 'Ï†ÑÏ≤¥'; };
                const scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });
                const handleScroll = () => showScrollTop.value = window.scrollY > 300;

                watch(fontSize, (newVal) => {
                    localStorage.setItem('sigma-font-size', newVal);
                });

                watch(currentFont, (newVal) => {
                    localStorage.setItem('sigma-font-family', newVal);
                });

                onMounted(() => { 
                    fetchData(); 
                    syncWithCloud(); // ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî ÏãúÏûë
                    window.addEventListener('scroll', handleScroll); 
                });
                onUnmounted(() => window.removeEventListener('scroll', handleScroll));

                return {
                    items, loading, searchQuery, selectedEra, selectedCategory,
                    uniqueEras, uniqueCategories, sortedFilteredList, resetFilters,
                    showScrollTop, scrollToTop, splitContent, isNumberedLine, isImportantLine, cleanText, renderLawContent, highlightText, currentTab, tabs,
                    fontSize, viewCounts, incrementViewCount, getViewCount, clearStats, isDataTab,
                    displayCount, fontOptions, currentFont,
                    showScoreInput, newScore, scoreHistory, dDay, avgScore, saveScore,
                    pinnedNodes, nodeMemos, selectedItem, togglePin, openPopup, closePopup, updateMemo,
                    isSyncing
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
