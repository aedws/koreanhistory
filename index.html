<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œêµ­ì‚¬ í‚¤ì›Œë“œ ì•”ê¸°ì¥</title>
    <script>
        // ë‹¤í¬ëª¨ë“œ ì„¤ì • ì´ˆê¸°í™”
        if (localStorage.getItem('darkMode') === 'true' || 
            (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>
    <!-- Tailwind CSS -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#121212',
                            card: '#1e1e1e',
                            header: '#1e1e1e',
                            text: '#e0e0e0',
                            subtext: '#b0b0b0'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; transition: background-color 0.3s; }
        .sticky-header { position: sticky; top: 0; z-index: 50; }
        /* Remove blue highlight on mobile tap */
        * { -webkit-tap-highlight-color: transparent; }

        /* ë‹¤í¬ëª¨ë“œ ì„¤ì • */
        @media (prefers-color-scheme: dark) {
            :root { color-scheme: dark; }
            body { background-color: #111827 !important; color: #f3f4f6 !important; }
            #app { background-color: #111827 !important; }
            .bg-white { background-color: #1f2937 !important; }
            .bg-gray-50 { background-color: #111827 !important; }
            .bg-gray-100 { background-color: #374151 !important; }
            .border-gray-100 { border-color: #374151 !important; }
            .border-b { border-color: #374151 !important; }
            .text-gray-900 { color: #f9fafb !important; }
            .text-gray-600 { color: #d1d5db !important; }
            .text-gray-400 { color: #9ca3af !important; }
            input, select { background-color: #374151 !important; border-color: #4b5563 !important; color: #f9fafb !important; }
            .sticky-header { background-color: rgba(31, 41, 55, 0.8) !important; border-bottom-color: #374151 !important; }
            .bg-blue-50 { background-color: #1e3a8a !important; color: #bfdbfe !important; }
            .bg-blue-100 { background-color: #1e3a8a !important; color: #93c5fd !important; }
            .bg-amber-50 { background-color: #451a03 !important; color: #fcd34d !important; }
            .text-blue-600 { color: #60a5fa !important; }
            .text-blue-700 { color: #93c5fd !important; }
        }

        /* ì‹œëŒ€ë³„ ìƒ‰ìƒ ì •ì˜ (ë‹¤í¬ëª¨ë“œ ëŒ€ì‘) */
        .era-ì „ì‚¼êµ­ì‹œëŒ€ { background-color: #fef3c7; color: #92400e; }
        .era-ì‚¼êµ­ì‹œëŒ€ { background-color: #dcfce7; color: #166534; }
        .era-ë‚¨ë¶êµ­ì‹œëŒ€ { background-color: #e0f2fe; color: #075985; }
        .era-ê³ ë ¤ { background-color: #f3e8ff; color: #6b21a8; }
        .era-ì¡°ì„  { background-color: #fee2e2; color: #991b1b; }
        .era-ê·¼ëŒ€ { background-color: #ffedd5; color: #9a3412; }
        .era-ì¼ì œê°•ì ê¸° { background-color: #f1f5f9; color: #334155; }
        .era-í˜„ëŒ€ { background-color: #ecfdf5; color: #065f46; }
        .era-default { background-color: #f3f4f6; color: #374151; }

        @media (prefers-color-scheme: dark) {
            .era-ì „ì‚¼êµ­ì‹œëŒ€ { background-color: #451a03; color: #fdba74; }
            .era-ì‚¼êµ­ì‹œëŒ€ { background-color: #064e3b; color: #6ee7b7; }
            .era-ë‚¨ë¶êµ­ì‹œëŒ€ { background-color: #0c4a6e; color: #7dd3fc; }
            .era-ê³ ë ¤ { background-color: #4c1d95; color: #ddd6fe; }
            .era-ì¡°ì„  { background-color: #7f1d1d; color: #fca5a5; }
            .era-ê·¼ëŒ€ { background-color: #7c2d12; color: #fdba74; }
            .era-ì¼ì œê°•ì ê¸° { background-color: #334155; color: #cbd5e1; }
            .era-í˜„ëŒ€ { background-color: #064e3b; color: #6ee7b7; }
        }
        .dark .era-ì‚¼êµ­ì‹œëŒ€ { background-color: #052e16; color: #86efac; }
        .dark .era-ë‚¨ë¶êµ­ì‹œëŒ€ { background-color: #082f49; color: #7dd3fc; }
        .dark .era-ê³ ë ¤ { background-color: #2e1065; color: #d8b4fe; }
        .dark .era-ì¡°ì„  { background-color: #450a0a; color: #fca5a5; }
        .dark .era-ê·¼ëŒ€ { background-color: #431407; color: #fdba74; }
        .dark .era-ì¼ì œê°•ì ê¸° { background-color: #1e293b; color: #cbd5e1; }
        .dark .era-í˜„ëŒ€ { background-color: #064e3b; color: #6ee7b7; }

        /* ë¶„ë¥˜ë³„ ìƒ‰ìƒ ì •ì˜ */
        .cat-ì •ì¹˜ { border-left: 4px solid #3b82f6; }
        .cat-ê²½ì œ { border-left: 4px solid #10b981; }
        .cat-ì‚¬íšŒ { border-left: 4px solid #f59e0b; }
        .cat-ë¬¸í™” { border-left: 4px solid #8b5cf6; }
        .cat-ì¸ë¬¼ { border-left: 4px solid #ef4444; }
        .cat-default { border-left: 4px solid #d1d5db; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-lg">
        
        <!-- ìƒë‹¨ ê³ ì • í—¤ë” -->
        <header class="sticky-header bg-white/80 backdrop-blur-md border-b px-4 pt-6 pb-4">
            <h1 class="text-xl font-bold text-gray-900 mb-4 flex items-center justify-between">
                <span>ğŸ‡°ğŸ‡· í•œëŠ¥ê²€ í‚¤ì›Œë“œ</span>
                <span class="text-xs font-normal text-gray-400">ë°ì´í„°: {{ items.length }}ê°œ</span>
            </h1>
            
            <!-- ê²€ìƒ‰ì°½ -->
            <div class="relative mb-3">
                <input type="text" v-model="searchQuery" 
                    placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì œëª©, ë‚´ìš©)" 
                    class="w-full h-12 px-4 bg-gray-100 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all text-base">
                <div class="absolute right-4 top-3.5 text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <!-- í•„í„° ì„¹ì…˜ (Select í•„ë“œ) -->
            <div class="grid grid-cols-2 gap-2">
                <div class="relative">
                    <select v-model="selectedEra" 
                        class="w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-xl text-sm appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="ì „ì²´">ëª¨ë“  ì‹œëŒ€</option>
                        <option v-for="era in uniqueEras" :key="era" :value="era">{{ era }}</option>
                    </select>
                    <div class="absolute right-3 top-3 pointer-events-none text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>
                <div class="relative">
                    <select v-model="selectedCategory" 
                        class="w-full h-10 px-3 bg-gray-50 border border-gray-200 rounded-xl text-sm appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="ì „ì²´">ëª¨ë“  ë¶„ë¥˜</option>
                        <option v-for="cat in uniqueCategories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>
                    <div class="absolute right-3 top-3 pointer-events-none text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>
            </div>
        </header>

        <!-- ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
        <main class="p-4 space-y-4">
            <!-- ë¡œë”© ìƒíƒœ -->
            <div v-if="loading" class="text-center py-20">
                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- ê²°ê³¼ ì—†ìŒ -->
            <div v-else-if="filteredList.length === 0" class="text-center py-20">
                <p class="text-gray-400">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ§</p>
                <button @click="resetFilters" class="mt-4 text-blue-500 text-sm font-semibold">í•„í„° ì´ˆê¸°í™”</button>
            </div>

            <!-- ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ -->
            <div v-else v-for="(item, idx) in filteredList" :key="idx" 
                :class="['group bg-white rounded-2xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow active:bg-gray-50', getCategoryClass(item.ë¶„ë¥˜)]">
                <div class="flex flex-wrap gap-2 mb-3">
                    <span :class="['inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold', getEraClass(item.ì‹œëŒ€)]">
                        {{ item.ì‹œëŒ€ }}
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600">
                        {{ item.ë¶„ë¥˜ }}
                    </span>
                    <span v-if="item.ì„¸ë¶€" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-600">
                        {{ item.ì„¸ë¶€ }}
                    </span>
                </div>
                <h2 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">{{ item.ì œëª© }}</h2>
                
                <!-- ë‚´ìš© íŒŒíŠ¸: / êµ¬ë¶„ìë¥¼ #íƒœê·¸ë¡œ ë³€ê²½ -->
                <div class="flex flex-wrap gap-1.5 mt-2">
                    <template v-for="(tag, tIdx) in splitContent(item.ë‚´ìš©)" :key="tIdx">
                        <span v-if="tag.trim()" class="inline-block text-[13px] text-blue-600 bg-blue-50 px-2 py-0.5 rounded-md font-medium">
                            #{{ tag.trim() }}
                        </span>
                    </template>
                </div>
            </div>
        </main>

        <!-- í•˜ë‹¨ í”Œë¡œíŒ… ë²„íŠ¼ (ë§¨ ìœ„ë¡œ) -->
        <button @click="scrollToTop" 
            class="fixed bottom-6 right-6 w-12 h-12 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center focus:outline-none active:scale-90 transition-transform"
            v-show="showScrollTop">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
            </svg>
        </button>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                const items = ref([]);
                const loading = ref(true);
                const searchQuery = ref('');
                const selectedEra = ref('ì „ì²´');
                const selectedCategory = ref('ì „ì²´');
                const showScrollTop = ref(false);

                // FIXME: êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ CSV URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”
                const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQE3ia0nwvZ99-e5SF707qTXOq1Vttc8urdPis0KiL7pHfduNdFawGElyYum3wrtl3yzHMdtSw5erix/pub?output=csv';

                // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                const fetchData = async () => {
                    loading.value = true;
                    try {
                        const response = await fetch(csvUrl);
                        if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        
                        const csvText = await response.text();
                        
                        Papa.parse(csvText, {
                            header: true,
                            skipEmptyLines: true,
                            complete: (results) => {
                                items.value = results.data.filter(row => row['ì œëª©']);
                                loading.value = false;
                            }
                        });
                    } catch (err) {
                        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
                        let message = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        if (location.protocol === 'file:') {
                            message += '\n\nì¸í„°ë„· ë³´ì•ˆ ì„¤ì •ìœ¼ë¡œ ì¸í•´ ë¡œì»¬ íŒŒì¼ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ì„ ì„œë²„(GitHub ë“±)ì— ì˜¬ë¦¬ê±°ë‚˜ VS Codeì˜ Live Serverë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.';
                        }
                        alert(message);
                        loading.value = false;
                    }
                };

                // ìœ ë‹ˆí¬í•œ ì‹œëŒ€/ë¶„ë¥˜ ëª©ë¡ ì¶”ì¶œ
                const uniqueEras = computed(() => [...new Set(items.value.map(i => i['ì‹œëŒ€']))].filter(Boolean));
                const uniqueCategories = computed(() => [...new Set(items.value.map(i => i['ë¶„ë¥˜']))].filter(Boolean));

                // ì‹¤ì‹œê°„ í•„í„°ë§ ë¡œì§
                const filteredList = computed(() => {
                    return items.value.filter(item => {
                        const s = searchQuery.value.toLowerCase();
                        // ëª¨ë“  í‚¤ì›Œë“œ(ì‹œëŒ€, ì„¸ë¶€, ë¶„ë¥˜, ì œëª©, ë‚´ìš©)ì—ì„œ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ìˆ˜ì •
                        const searchableText = `${item['ì‹œëŒ€']} ${item['ì„¸ë¶€']} ${item['ë¶„ë¥˜']} ${item['ì œëª©']} ${item['ë‚´ìš©']}`.toLowerCase();
                        const matchSearch = searchableText.includes(s);
                        
                        const matchEra = selectedEra.value === 'ì „ì²´' || item['ì‹œëŒ€'] === selectedEra.value;
                        const matchCat = selectedCategory.value === 'ì „ì²´' || item['ë¶„ë¥˜'] === selectedCategory.value;
                        
                        return matchSearch && matchEra && matchCat;
                    });
                });

                const resetFilters = () => {
                    searchQuery.value = '';
                    selectedEra.value = 'ì „ì²´';
                    selectedCategory.value = 'ì „ì²´';
                };

                const scrollToTop = () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };

                const handleScroll = () => {
                    showScrollTop.value = window.scrollY > 300;
                };

                // íƒœê·¸ ë¶„ë¦¬ ë¡œì§ (ë‚´ìš© ì¤‘ / ê¸°ì¤€)
                const splitContent = (content) => {
                    if (!content) return [];
                    return content.split('/');
                };

                // ì‹œëŒ€ë³„ ìƒ‰ìƒ í´ë˜ìŠ¤ ë°˜í™˜
                const getEraClass = (era) => {
                    const eraMap = {
                        'ì „ì‚¼êµ­ì‹œëŒ€': 'era-ì „ì‚¼êµ­ì‹œëŒ€',
                        'ì‚¼êµ­ì‹œëŒ€': 'era-ì‚¼êµ­ì‹œëŒ€',
                        'ë‚¨ë¶êµ­ì‹œëŒ€': 'era-ë‚¨ë¶êµ­ì‹œëŒ€',
                        'ê³ ë ¤': 'era-ê³ ë ¤',
                        'ì¡°ì„ ': 'era-ì¡°ì„ ',
                        'ê·¼ëŒ€': 'era-ê·¼ëŒ€',
                        'ì¼ì œê°•ì ê¸°': 'era-ì¼ì œê°•ì ê¸°',
                        'í˜„ëŒ€': 'era-í˜„ëŒ€'
                    };
                    return eraMap[era] || 'era-default';
                };

                // ë¶„ë¥˜ë³„ ì™¼ìª½ ë°” ìƒ‰ìƒ í´ë˜ìŠ¤ ë°˜í™˜
                const getCategoryClass = (cat) => {
                    const catMap = {
                        'ì •ì¹˜': 'cat-ì •ì¹˜',
                        'ê²½ì œ': 'cat-ê²½ì œ',
                        'ì‚¬íšŒ': 'cat-ì‚¬íšŒ',
                        'ë¬¸í™”': 'cat-ë¬¸í™”',
                        'ì¸ë¬¼': 'cat-ì¸ë¬¼'
                    };
                    return catMap[cat] || 'cat-default';
                };

                onMounted(() => {
                    fetchData();
                    window.addEventListener('scroll', handleScroll);
                });

                onUnmounted(() => {
                    window.removeEventListener('scroll', handleScroll);
                });

                return {
                    items, loading, searchQuery, selectedEra, selectedCategory,
                    uniqueEras, uniqueCategories, filteredList, resetFilters,
                    showScrollTop, scrollToTop, splitContent, getEraClass, getCategoryClass
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

